(function(){var a=this,b=function(a){if(b.typecheck.isArray(a)||b.typecheck.isObject(a))return new b.Generator(a);if(b.typecheck.isNumber(a)){var c=Math.floor(a),d=arguments[1]!==undefined&&b.typecheck.isNumber(arguments[1])?Math.ceil(arguments[1]):c+1;return new b.Range(c,d)}},c=a.kira;a.kira=b,b.noConflict=function(){return a.kira=c,b},b.typecheck={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},isObject:function(a){return a===Object(a)},isArguments:function(a){return Object.prototype.toString.call(a)==="[object Arguments]"},isFunction:function(a){return Object.prototype.toString.call(a)==="[object Function]"},isString:function(a){return Object.prototype.toString.call(a)==="[object String]"},isNumber:function(a){return Object.prototype.toString.call(a)==="[object Number]"},isDate:function(a){return Object.prototype.toString.call(a)==="[object Date]"},isRegExp:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"}};var d=a.console;b.console={log:function(a){return d.log(a),a},profile:function(a){var b=(new Date).getTime();return a(),(new Date).getTime()-b},logProfile:function(a,c){c===undefined&&(c=a,a="%s"),d.log(a.replace("%s",b.profile(c)))}};var e=Object.getOwnPropertyNames;b.objects={extend:function(){var a={};for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a},append:function(a,b,c){return c===undefined?a.push(b):a[b]=c,a},keys:function(a){if(e!==undefined)return e(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}};var f=Array.prototype.forEach,g=Array.prototype.filter,h=Array.prototype.map,i=Array.prototype.every,j=Array.prototype.some,k=Array.prototype.reduce,l=Array.prototype.indexOf;b.arrays={map:function(a,b){if(a.map===h&&h!==undefined)return a.map(b);var c=[];for(var d=0,e=a.length;d<e;d++)c.push(b(a[d]));return c},flat:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){var f=b(a[d]);for(var g=0,h=f.length;g<h;g++)c.push(f[g])}return c},filter:function(a,b){if(a.filter===g&&g!==undefined)return a.filter(b);var c=[];for(var d=0,e=a.length;d<e;d++){var f=a[d];b(f)&&c.push(f)}return c},zip:function(a,b){var c=[];for(var d=0,e=Math.min(a.length,b.length);d<e;d++)c.push([a[d],b[d]]);return c},each:function(a,b){if(a.forEach===f&&f!==undefined)return a.forEach(b);for(var c=0,d=a.length;c<d;c++)b(a[c])},group:function(a,b){var c={};for(var d=0,e=a.length;d<e;d++){var f=a[d],g=b(f);c[g]===undefined?c[g]=[f]:c[g].push(f)}return c},all:function(a,b){if(a.every===i&&i!==undefined)return a.every(b);for(var c=0,d=a.length;c<d;c++)if(!b(a[c]))return!1;return!0},any:function(a,b){if(a.some===j&&j!==undefined)return a.some(b);for(var c=0,d=a.length;c<d;c++)if(!b(a[c]))return!1;return!0},reduce:function(a,b){if(a.reduce===k&&k!==undefined)try{return[a.reduce(b)]}catch(c){if(c.type==="reduce_no_initial")return[];throw c}var d=a.length;if(d>0){var e=a[0];for(var f=1;f<d;f++)e=b(e,a[f]);return[e]}return[]},fold:function(a,b,c){if(a.reduce===k&&k!==undefined)return a.reduce(c,b);for(var d=0,e=a.length;d<e;d++)b=c(b,a[d]);return b},find:function(a,c){var d;return b.arrays.any(a,function(a){return c(a)?(d=a,!0):!1})?[d]:[]},indexOf:function(a,b){if(a.indexOf===l&&l!==undefined){var c=a.indexOf(b);return c>=0?[c]:[]}for(var d=0,e=a.length;d<e;d++)if(a[d]===b)return[d];return[]},toSet:function(a){var b={};for(var c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}},b.options={get:function(a,c,d){return d===undefined?b.options.getOption(a,c):b.typecheck.isFunction(d)?b.options.getOrElseLazy(a,c,d):b.options.getOrElse(a,c,d)},getOption:function(a,b){var c=a[b];return c===undefined?[]:[c]},getOrElse:function(a,b,c){var d=a[b];return d===undefined?c:d},getOrElseLazy:function(a,b,c){var d=a[b];return d===undefined?c():d},orElse:function(a,c,d){return b.typecheck.isFunction(d)?b.options.orElseLazy(a,c,d):b.options.orElseOption(a,c,d)},orElseOption:function(a,b,c){var d=a[b];return d===undefined?c:[d]},orElseLazy:function(a,b,c){var d=a[b];return d===undefined?c():[d]},nullable:function(a){return a===null||a===undefined?[]:[a]}},b.Generator=function(a){a!==undefined&&(b.typecheck.isArray(a)?this.iterator=function(){var b=a.length,c=0;return{next:function(){if(c<b)return a[c++]}}}:this.iterator=function(){var c=b.objects.keys(a),d=c.length,e=0;return{next:function(){if(e<d){var b=c[e++];return[b,a[b]]}}}})},b.Generator.empty=new b.Generator,b.Generator.prototype.iterator=function(){return{next:function(){}}},b.Generator.prototype.cache=function(){var a=this,c,d=new b.Generator;return d.iterator=function(){if(c===undefined){var d=[],e=a.iterator();return{next:function(){var a=e.next();return a!==undefined?d.push(a):c=new b.Generator(d),a}}}return c.iterator()},d},b.Generator.prototype.map=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator();return{next:function(){var c=b.next();if(c!==undefined)return a(c)}}},d},b.Generator.prototype.flat=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d,e;return{next:function(){e!==undefined&&(e=d.next());if(e===undefined)do{var c=b.next();if(c===undefined)return;d=a(c).iterator(),e=d.next()}while(e===undefined);return e}}},d},b.Generator.prototype.filter=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator();return{next:function(){var c;do c=b.next();while(c!==undefined&&!a(c));return c}}},d},b.Generator.prototype.zip=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d=a.iterator();return{next:function(){var a=b.next(),c=d.next();if(a!==undefined&&c!==undefined)return[a,c]}}},d},b.Generator.prototype.drop=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d=!1;return{next:function(){if(!d){d=!0;for(var c=0;c<a;c++)if(b.next()===undefined)return}return b.next()}}},d},b.Generator.prototype.dropWhile=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d=!1;return{next:function(){while(!d){var c=b.next();if(c===undefined)return;d=!a(c);if(d)return c}return b.next()}}},d},b.Generator.prototype.limit=function(a,c){var d=this,e=new b.Generator;return e.iterator=function(){var b=d.iterator(),e=!1,f;return{next:function(){if(!e){e=!0,f=-1;while(++f<a)if(b.next()===undefined)return}if(f++<c)return b.next()}}},e},b.Generator.prototype.take=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d=0;return{next:function(){if(d++<a)return b.next()}}},d},b.Generator.prototype.takeWhile=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d=!0;return{next:function(){if(d){var c=b.next();if(c!==undefined&&(d=a(c)))return c}}}},d},b.Generator.prototype.concatenate=function(a){var c=this,d=new b.Generator;return d.iterator=function(){var b=c.iterator(),d;return{next:function(){if(d===undefined){var c=b.next();return c===undefined?(d=a.iterator(),d.next()):c}return d.next()}}},d},b.Generator.prototype.each=function(a){for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())if(a(c)===!1)break},b.Generator.prototype.all=function(a){for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())if(!a(c))return!1;return!0},b.Generator.prototype.any=function(a){for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())if(a(c))return!0;return!1},b.Generator.prototype.fold=function(a,b){for(var c=this.iterator(),d=c.next();d!==undefined;d=c.next())a=b(d,a);return a},b.Generator.prototype.reduce=function(a){var b=this.iterator(),c=b.next();if(c===undefined)return[];for(;;){var d=b.next();if(d===undefined)break;c=a(c,d)}return[c]},b.Generator.prototype.find=function(a){for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())if(a(c))return[c];return[]},b.Generator.prototype.index=function(a){var b=0;for(var c=this.iterator(),d=c.next();d!==undefined;d=c.next()){if(a(d))return[b];b++}return[]},b.Generator.prototype.get=function(a){var b=0;for(var c=this.iterator(),d=c.next();d!==undefined;d=c.next()){if(b===a)return[d];b++}return[]},b.Generator.prototype.toArray=function(){var a=[];for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())a.push(c);return a},b.Generator.prototype.toSet=function(){var a={};for(var b=this.iterator(),c=b.next();c!==undefined;c=b.next())a[c]=!0;return a},b.Range=function(a,b){this._defined=a!==undefined&&b!==undefined&&a<=b,this._defined?(this._left=a,this._right=b,this._length=b-a):(this._left=0,this._right=0,this._length=0)},b.Range.notdefined=new b.Range,b.Range.index=new b.Range(0,268435456),b.Range.prototype.isDefined=function(){return this._defined},b.Range.prototype.getLeft=function(){return this._left},b.Range.prototype.getRight=function(){return this._right},b.Range.prototype.getLength=function(){return this._length},b.Range.prototype.map=function(a,c){return this._defined?new b.Range(a(this._left),c===undefined?a(this._right):c(this._right)):this},b.Range.prototype.union=function(a){return b.typecheck.isNumber(a)?this.unionWithPoint(a):this.unionWithRange(a)},b.Range.prototype.unionWithPoint=function(a){return a=Math.floor(a),this._defined?new b.Range(Math.min(a,this._left),Math.max(a+1,this._right)):new b.Range(a,a+1)},b.Range.prototype.unionWithRange=function(a){return this._defined&&a._defined?new b.Range(Math.min(this._left,a._left),Math.max(this._right,a._right)):this._defined?this:a},b.Range.prototype.inject=function(a){return this._defined&&a._defined?this._right<=a._left?new b.Range(this._left,a._right):a._right<=this._left?new b.Range(a._left,this._right):this._left<=a._left?new b.Range(this._left,this._right+a._length):new b.Range(a._left,a._right+this._length):this._defined?this:a},b.Range.prototype.enlarge=function(a){return this._defined?new b.Range(this._left-a[0],this._right+a[1]):this},b.Range.prototype.shift=function(a){return this._defined?new b.Range(this._left+a,this._right+a):this},b.Range.prototype.sub=function(a){return b.typecheck.isString(a)?this.substring(a):this.subarray(a)},b.Range.prototype.replace=function(a,c){return b.typecheck.isString(a)?this.replaceString(a,c):this.replaceArray(a,c)},b.Range.prototype.substring=function(a){return this._defined?a.substring(this._left,this._right):""},b.Range.prototype.replaceString=function(a,b){return this._defined?a.substring(0,this._left)+b+a.substring(this._right):a},b.Range.prototype.subarray=function(a){return this._defined?a.slice(this._left,this._right):[]},b.Range.prototype.replaceArray=function(a,b){var c=a.slice(0);if(this._defined){var d=b.slice(0);d.unshift(this._left,this._length),c.splice.apply(c,d)}return c},b.Range.prototype.limit=function(a){if(this._defined){var c=this._left,d=this._right,e=new b.Generator;return e.iterator=function(){var b=a.iterator(),e=!1,f;return{next:function(){if(!e){e=!0,f=-1;while(++f<c)if(b.next()===undefined)return}if(f++<d)return b.next()}}},e}return this},b.Range.prototype.toGenerator=function(){var a=this;if(this._defined){var c=new b.Generator;return c.iterator=function(){var b=a._left-1;return{next:function(){b++;if(b<a._right)return b}}},c}return b.Generator.empty},b.Range.prototype.toOption=function(){return this._defined?[this]:[]},b.Range.prototype.toString=function(){return this._defined?"Range("+this._left+", "+this._right+")":"Range()"}})();